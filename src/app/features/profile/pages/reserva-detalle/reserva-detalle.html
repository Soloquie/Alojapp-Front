<div class="min-h-screen bg-[#f6f8f8] font-display flex justify-center py-5 px-4 sm:px-6 md:px-10 lg:px-20">
  <div class="w-full max-w-[960px]">

    <div class="flex items-center justify-between gap-4 p-4">
      <button class="p-2 text-slate-800" (click)="back()">
        <span class="material-symbols-outlined text-2xl">arrow_back</span>
      </button>
      <p class="text-slate-900 text-2xl sm:text-3xl font-black tracking-tighter text-center flex-1">
        Detalle de Reserva
      </p>
      <div class="w-10 h-10"></div>
    </div>

    <ng-container *ngIf="!cargando && reserva as r; else loadingTpl">

      <!-- Imagen de alojamiento -->
      <img
        class="w-32 h-32 rounded-xl object-cover"
       [src]="r.alojamientoImagen || 'assets/placeholder.jpg'"
        alt="Alojamiento"
      />

      <!-- Título + dirección -->
      <h1 class="text-slate-900 tracking-tight text-[32px] font-bold leading-tight px-4 text-left pb-1 pt-6">
        {{ r.alojamientoTitulo }}
      </h1>
      <div class="flex items-center gap-2 px-4 pb-4 pt-1" *ngIf="r.direccion || r.ciudad">
        <span class="material-symbols-outlined text-slate-600">location_on</span>
        <p class="text-slate-600 text-base">
          {{ r.direccion }}
          <ng-container *ngIf="r.ciudad">, {{ r.ciudad }}</ng-container>
        </p>
      </div>

      <!-- Anfitrión -->
      <div class="px-4 py-3">
        <div class="flex items-center gap-4 p-4 rounded-lg bg-white/70 border border-slate-200">
          <img
            class="h-12 w-12 rounded-full object-cover"
            [src]="r.anfitrionFotoUrl || 'assets/avatar.png'"
            alt="Anfitrión"
          />
          <div>
            <p class="text-sm text-slate-500">Anfitrión</p>
            <p class="font-bold text-slate-800">{{ r.anfitrionNombre || 'Anfitrión' }}</p>
          </div>
        </div>
      </div>

      <div class="px-4 py-4">
        <hr class="border-slate-200" />
      </div>

      <!-- Fechas y huéspedes -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-4 py-2">
        <div class="flex items-start gap-3 p-4 rounded-lg bg-white/70">
          <span class="material-symbols-outlined text-primary mt-1">calendar_month</span>
          <div>
            <p class="font-bold text-slate-800">Check-in</p>
            <p class="text-slate-600">{{ r.fechaCheckin | date:'dd/MM/yyyy' }}</p>
          </div>
        </div>
        <div class="flex items-start gap-3 p-4 rounded-lg bg-white/70">
          <span class="material-symbols-outlined text-primary mt-1">calendar_month</span>
          <div>
            <p class="font-bold text-slate-800">Check-out</p>
            <p class="text-slate-600">{{ r.fechaCheckout | date:'dd/MM/yyyy' }}</p>
          </div>
        </div>
      </div>

      <div class="px-4 py-4">
        <hr class="border-slate-200" />
      </div>

    

      <!-- Cancelar reserva -->
      <div class="px-4 pt-8 pb-2" *ngIf="(r.estado || '').toUpperCase() !== 'CANCELADA'">
        <h2 class="text-xl font-bold text-slate-900 pb-4">Cancelar reserva</h2>
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2" for="cancellation-reason">
            Motivo de la cancelación
          </label>
          <textarea
            id="cancellation-reason"
            [(ngModel)]="motivoCancelacion"
            rows="4"
            class="w-full rounded-md border-slate-300 bg-white/70 text-slate-900 shadow-sm
                   focus:border-red-500 focus:ring-red-500 placeholder:text-slate-400"
            placeholder="Escribe aquí el motivo de tu cancelación..."
          ></textarea>
        </div>
      </div>

      <div class="px-4 pt-4 pb-6" *ngIf="(r.estado || '').toUpperCase() !== 'CANCELADA'">
        <button
          class="w-full text-center rounded-lg bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6
                 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500
                 focus:ring-offset-2"
          (click)="cancelar()"
          [disabled]="cancelando">
          {{ cancelando ? 'Cancelando…' : 'Cancelar reserva' }}
        </button>
      </div>

      <div class="px-4 pb-4 text-red-600" *ngIf="error">{{ error }}</div>

    </ng-container>

    <ng-template #loadingTpl>
      <div class="px-4 py-10 text-slate-600">Cargando reserva…</div>
    </ng-template>

  </div>
</div>
